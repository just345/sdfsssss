<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fizik Dersi / UNDERTALE Web Port</title>
<style>
html, body { margin:0; padding:0; width:100%; height:100%; font-family:monospace; color:white; overflow:hidden; }
body { background:#1a1a1a; display:flex; justify-content:center; align-items:center; flex-direction:column; }
#lesson { text-align:center; padding:40px; max-width:800px; }
#lesson h1 { font-size:2em; margin-bottom:20px; color:#bdff00; }
#lesson p { font-size:1.2em; line-height:1.6; margin-bottom:15px; }
canvas.emscripten { display:none; background:black; width:100%; height:100%; }
.spinner { border:5px solid #bdff00; border-top:5px solid #719900; border-radius:50%; width:40px; height:40px; animation:spin 1s linear infinite; margin:20px; }
@keyframes spin { 0%{transform:rotate(0deg);} 100%{transform:rotate(360deg);} }
.loading { position:absolute; top:0; left:0; right:0; bottom:0; display:flex; flex-direction:column; justify-content:center; align-items:center; display:none; }
progress { width:300px; height:15px; margin-top:10px; }
#pauseMenuContainer { position:absolute; top:0; left:0; right:0; bottom:0; display:flex; justify-content:center; align-items:center; }
#pauseMenuContainer[hidden] { display:none; }
#pauseMenuBorder { background:linear-gradient(135deg,#fa1e4e,transparent 40%); padding:1px; border-radius:4px; }
#pauseMenu { display:flex; flex-direction:column; padding:60px 30px; background:linear-gradient(180deg,#2e273f 16%,rgba(46,39,63,0.79) 56%,#2e273f 91%); border-radius:4px; }
#pauseMenu button { font-weight:500; font-size:17px; color:white; background:#fa1e4e; border:1px solid #fa1e4e; border-radius:6px; padding:12px 24px; margin:5px 0; cursor:pointer; }
</style>
</head>
<body>

<!-- Physics Lesson Front -->
<div id="lesson">
  <h1>Fizik Dersi</h1>
  <p>Merhaba! Bugün temel fizik konularını öğreneceğiz.</p>
  <p>1. Hareket: Cisimlerin konum değişimleri ve hızları.</p>
  <p>2. Kuvvet: Cisimler üzerinde etkili olan itme ve çekme kuvvetleri.</p>
  <p>3. Enerji: İş, kinetik ve potansiyel enerji kavramları.</p>
  <p>4. Basit örnekler: Yerçekimi ve serbest düşme hareketi.</p>
  <p>Oyunu açmak için gizli kelimeyi klavyenizde yazın!</p>
</div>

<!-- Game Canvas & Loading -->
<canvas class="emscripten" id="canvas" tabindex="-1"></canvas>
<div id="pauseMenuContainer" hidden>
  <div id="pauseMenuBorder">
    <div id="pauseMenu">
      <button id="resumeButton" onclick="resume()">Resume</button>
      <button id="quitButton" onclick="quitIfSupported()">Quit</button>
    </div>
  </div>
</div>
<div class="loading" id="loading">
  <div class="spinner" id="spinner"></div>
  <div class="emscripten" id="status">Downloading... 0%</div>
  <progress value="0" max="100" id="progress"></progress>
</div>

<script>
// --- Secret Key Detection ---
let typed = '';
const secret = 'undertale';
document.addEventListener('keydown', e => {
    typed += e.key.toLowerCase();
    if (!secret.startsWith(typed)) {
        typed = e.key.toLowerCase(); // reset if sequence breaks
    }
    if (typed === secret) {
        startGame();
    }
});

function startGame() {
    // Hide lesson
    document.getElementById('lesson').style.display = 'none';
    // Show game canvas & loading
    document.getElementById('canvas').style.display = 'block';
    document.getElementById('loading').style.display = 'flex';
    loadGame();
}

// --- Game Loading (your original code) ---
const BASE_URL = 'https://cdn.jsdelivr.net/gh/just345/sdfsssss@main/'; 

var Module = {
  locateFile: function(file) {
    if (file.endsWith('.data') || file.endsWith('.wasm')) {
      return BASE_URL + file;
    }
    return file;
  }
};

const parts = [
  'game.unx.part1',
  'game.unx.part2',
  'game.unx.part3',
  'game.unx.part4',
  'game.unx.part5'
].map(p => BASE_URL + p);

async function mergeFiles(parts) {
  const buffers = [];
  for (let i = 0; i < parts.length; i++) {
    const res = await fetch(parts[i]);
    if (!res.ok) throw new Error(`Failed to load ${parts[i]}`);
    const data = await res.arrayBuffer();
    buffers.push(data);
    const progress = Math.round(((i+1)/parts.length)*100);
    document.getElementById('progress').value = progress;
    document.getElementById('status').innerText = `Downloading... ${progress}%`;
  }
  return URL.createObjectURL(new Blob(buffers));
}

function loadGame() {
  mergeFiles(parts).then(url => {
    window.gameUnxUrl = url;

    const originalFetch = window.fetch;
    window.fetch = async function(input, init) {
      if ((typeof input==='string' && input.includes('game.unx')) || 
          (input instanceof Request && input.url.includes('game.unx'))) {
        input = window.gameUnxUrl;
      }
      return originalFetch(input, init);
    };

    const originalOpen = XMLHttpRequest.prototype.open;
    XMLHttpRequest.prototype.open = function(method, url, ...rest) {
      if (url.includes('game.unx')) url = window.gameUnxUrl;
      return originalOpen.call(this, method, url, ...rest);
    };

    const indexScript = document.createElement('script');
    indexScript.src = BASE_URL + 'index.js';
    indexScript.onload = () => {
      const runnerScript = document.createElement('script');
      runnerScript.src = BASE_URL + 'runner.js';
      document.body.appendChild(runnerScript);
    };
    document.body.appendChild(indexScript);

  }).catch(err => {
    console.error('Failed to load game:', err);
    document.getElementById('status').innerText = 'Failed to load game.';
  });
}
</script>

</body>
</html>
